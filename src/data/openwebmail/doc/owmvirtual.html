<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en"><html><head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.77 [en] (X11; U; Linux 2.4.17 i686) [Netscape]"><title>owmvirtual.html</title></head><body><center><b><font size="+3">How to setup virtual users on Open WebMail using
Postfix &amp; vm-pop3d</font></b>
<br>
<br>Written by <a href="mailto:kevin@bluelavalamp.net">Kevin L. Ellis</a></center>

<br>&nbsp;
<p><br>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
This tutorial will show you how to setup Open WebMail (OWM) so that you
can have both real users and pure virtual users access mail by either pop3
(i.e. Netscape, etc) or by using a web interface (Open WebMail).&nbsp;
A "pure" virtual user to me is one that does not have an account on the
machine, there is no entry in /etc/passwd for them.&nbsp; They only exist
to the e-mail system.&nbsp; You will be able to setup virtual users for
both the main domain of the box and virtual domains that the box hosts.&nbsp;
You will also be able to use the same user name for different domains,
there are no limitations with user names.</font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Get down <a href="http://turtle.ee.ncku.edu.tw/openwebmail/">Open WebMail</a>,
<a href="http://www.postfix.org">Postfix</a>, and <a href="http://www.reedmedia.net/software/virtualmail-pop3d/">vm-pop3d</a> 
and install them all.&nbsp; Read through how vm-pop3d works so you have a
general understanding of how it's able to service virtual users. &nbsp;Get
all these working together before you proceed any further.</font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
We are going to configure OWM&nbsp;to use the standard unix authentication for real users,
so we need to setup <tt>auth_unix.pl</tt> to point to our passwd file.&nbsp;
For me this is <tt>/etc/passwd</tt> and </font><font size="+1"><tt>/etc/shadow</tt>,&nbsp; your system may vary.<br>
</font></p>
<p><font size="+1">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
Now we need to setup the authentication module for virtual users. &nbsp;For
this we are going to use </font><font size="+1"><tt>auth_vdomain.pl</tt>. &nbsp;You could also use&nbsp;</font><font size="+1"> </font><font size="+1"><tt>auth_pop3.pl</tt></font><font size="+1"> for this,</font><font size="+1"> which I'll talk about briefly later. &nbsp;The only thing you need to setup in </font><font size="+1"><tt>auth_vdomain.pl</tt> is </font><font size="+1"><tt>$local_uid</tt> and that needs to match how you configured Postfix and vm-pop3d. &nbsp;All three need to match to use the same user id. &nbsp;<br>
</font></p>
<p><font size="+1">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; For Postfix you want to see what you have </font><font size="+1"><tt>default_privs</tt> set to in </font><font size="+1"><tt>main.cf</tt></font><font size="+1">.
&nbsp;For vm-pop3d you need to determine what user id it's running as for
a virtual user. &nbsp;You could either configure vm-pop3d by editing vm-pop3d.h
and changing the </font><font size="+1"><tt>#define VIRTUAL_UID</tt> or by passing it the '</font><font size="+1"><tt>--user</tt>' or '</font><font size="+1"><tt>-u</tt>' commandline option to change the user id it will run as. &nbsp;In the </font><font size="+1"><tt>auth_vdomain.pl</tt> module you need to set the </font><big><tt>my $local_uid</tt></big><font size="+1"> line to match Postfix and what you have for vm-pop3d. &nbsp;Postfix and vm-pop3d normally have these set to the </font><font size="+1"><tt>nobody</tt> user, which is what </font><font size="+1"><tt>auth_vdomain.pl</tt> defaults too, so you don't have to do anything. &nbsp;I'm running my system to have Postfix and vm-pop3d set to user id of </font><font size="+1"><tt>mail</tt>, so on my system I have vm-pop3d.h set as:<br>
</font></p>
<p><big><tt>#define VIRTUAL_UID&nbsp;&nbsp;&nbsp;&nbsp; 8<br>
</tt></big>
</p>

<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <big>And in <tt>auth_vdomain.pl</tt> I have it set to: </big></p>
<p><big><tt>my $local_uid=getpwnam('mail');<br>
</tt></big>
<br>

</p>
<p><font size="+1">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
</font><font size="+1">If you wanted
the whole thing to use a different user id, like </font><font size="+1"><tt>vwebmail</tt>, you could create a new user and use that id. &nbsp;Just make sure all three programs are using the same user id. &nbsp;</font><br>
<br>
</p>
<p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Now we need to make changes to <tt>openwebmail.conf</tt>.&nbsp; Setup <tt>mailspooldir</tt>
to point to your <i><u>normal</u></i> mail spool directory.&nbsp; For me
this is <tt>/var/spool/mail</tt>.&nbsp; This is the spool that real users
get their mail delivered to.&nbsp; We also want to setup OWM to default to using unix
style authentication,&nbsp; so set <tt>auth_module</tt>&nbsp; to&nbsp;
<tt>auth_unix.pl.&nbsp;</tt></font>
</p>
<p><tt><font size="+1">mailspooldir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/var/spool/mail</font></tt>
<br><tt><font size="+1">auth_module&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_unix.pl</font></tt>
</p>
<p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
This will configure OWM so that real users will be able to access either
regular e-mail using Open WebMail without having to do anything special.&nbsp;
When a real user of the system logs in using just their user name (e.g.
john), then OWM will authenticate that user using the systems passwd file.</font>&nbsp;</p>
<p><br>
<big>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; I also have this in my config file:<br>
</big>
</p>
<p><tt><big>enable_setfromemail&nbsp;&nbsp;&nbsp; no
</big></tt></p>

<p><font size="+1">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; I don't want my users to be able to change
their e-mail address to anything they want, so I turn off this feature in
the main config.<br>
</font></p>

<p>&nbsp;
</p>
<p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Virtual users must be setup and created before they will work.</font>
<br>&nbsp;
</p><p><b><u><font size="+2">Step 1</font></u></b>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
If this virtual user is at a virtual domain your machine is hosting, then
add a mapping for the user in <tt>/etc/postfix/virtual.cf</tt>.&nbsp; The
lines you will add will look something like this:</font><font size="+1"></font>
</p><p><tt><font size="+1">virtualdomain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
anything</font></tt>
<br><tt><font size="+1">username@virtualdomain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
username.virtualdomain</font></tt>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
The first line only needs to be done once per virtual domain name.</font><font size="+1"></font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Example:</font>
</p><p><tt><font size="+1">virtualcompany.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
anything</font></tt>
<br><tt><font size="+1">john@virtualcompany.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
john.virtualcompany.com</font></tt>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
This will map any incoming mail to <tt>john@virtualcompany.com</tt> to
a user named <tt>john.virtualcompany.com</tt>.&nbsp;&nbsp; Once you've
added this run the command '<tt>postmap /etc/postfix/virtual.cf</tt>' to
update the virtual table.</font><font size="+1"></font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Note: if this is a virtual user to the main domain of the machine, you
don't have to add an entry to <tt>virtual.cf</tt>.</font>
<br>&nbsp;
</p><p><b><u><font size="+2">Step 2</font></u></b>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Add a local alias to <tt>/etc/aliases</tt> for this user.&nbsp; If this
is a virtual user to the domain of the host machine, then you'll add a
line like this:</font><font size="+1"></font>
</p><p><tt><font size="+1">username:&nbsp; /var/spool/virtual/domain/name</font></tt>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For example, if you are adding a virtual user (<tt>joe</tt>) for the domain
of the machine (<tt>widgets.com</tt>), you'd add:</font>
</p><p><tt><font size="+1">joe:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/spool/virtual/widgets.com/joe</font></tt>
<br><tt><font size="+1"></font></tt>&nbsp;
<br>&nbsp;
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
On the other hand, if it's to a virtual domain, then the username should
be the username.domain and 'domain' will be that virtual domain.&nbsp;
Continuing the example in step 1, we'd add:</font>
</p><p><tt><font size="+1">john.virtualcompany.com:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/var/spool/virtual/virtualcompany.com/john</font></tt>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
After that we need to update Postfix's alias database, so run the command
'<tt>postalias /etc/aliases</tt>'.</font>
<br><font size="+1"></font>&nbsp;<font size="+1"></font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Step 1 tell postfix that mail directed to <tt>john@virtualcompany.com</tt>&nbsp;
should first be mapped to a user named <tt>john.virtualcompany.com</tt>&nbsp;
and step 2 tells postfix to then place that users mail in the mail spool
file <tt>/var/spool/virtual/virtualcompany.com/john</tt></font>
<br><tt></tt>&nbsp;<tt></tt>
</p><p><b><u><font size="+1">Step 3</font></u></b>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Now we need to make a mail spool directory for it.&nbsp; Make a directory
in <tt>/var/spool/virtual</tt> with the name of the domain.</font><font size="+1"></font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For our virtual user joe at the main domain of the host machine, we'd do:</font><font size="+1"></font>
</p><p><tt><font size="+1">mkdir /var/spool/virtual/widgets.com</font></tt>
<br><font size="+1"></font>&nbsp;<font size="+1"></font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For our virtual user john at the virtual domain , we'd do:</font>
</p><p><tt><font size="+1">mkdir /var/spool/virtual/virtualcompany.com</font></tt>
<br><font size="+1"></font>&nbsp;<font size="+1"></font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Once that's done we need to execute these two commands:</font>
</p><p><tt><font size="+1">chown root.mail /var/spool/virtual/domain</font></tt>
<br><tt><font size="+1">chmod og+wt /var/spool/virtual/domain</font></tt>
<br><tt><font size="+1"></font></tt>&nbsp;
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For our example we started in step 1, we'd execute:</font>
</p><p><tt><font size="+1">mkdir /var/spool/virtual/virtualcompany.com</font></tt>
<br><tt><font size="+1">chown root.mail /var/spool/virtual/virtualcompany.com</font></tt>
<br><tt><font size="+1">chmod og+wt /var/spool/virtual/virtualcompany.com</font></tt>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
If this mail spool directory already exists we can skip this step.&nbsp; Thus,
once you perform this step for one virtual user at this domain, any other
virtual users at this domain you create you don't have to do this. &nbsp;Adding
new users can also be done through a web interface using </font><font size="+1"><tt>openwebmail-vdomain.pl</tt> module. &nbsp;We'll also set that up with an administrator so you can add, change, or delete users using a browser.</font><br>&nbsp;
</p><p><b><u><font size="+1">Step 4</font></u></b>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Now we need to configure OWM for virtual users at these domains using Open
WebMail's per site configuration feature.&nbsp; Go to <tt>/usr/local/apache/cgi-bin/openwebmail/etc/sites.conf</tt>&nbsp;
(or to your Open WebMail location) and make a new file named 'domain',
then add these lines:</font><font size="+1"></font>
</p>
<p><tt><font size="+1">mailspooldir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/var/spool/virtual/DOMAIN</font></tt>
<br><tt><font size="+1">auth_withdomain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
yes<br>
auth_module&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;auth_vdomain.pl</font></tt><br><big><tt>
domainnames&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;DOMAIN<br>
</tt></big>
<tt><font size="+1">use_homedirspools&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>
<tt><font size="+1">use_syshomedir&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>
<tt><font size="+1">enable_autoreply&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>
<tt><font size="+1">enable_setforward&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>
<br>
<tt><font size="+1"></font></tt></p>
<p><big>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; If you want
to setup admin account(s) for this virtual domain then you should also turn
on <tt>vdomain</tt> support and specify an admin user name. &nbsp;Here's an example of how to turn it on with an admin named <tt>admin_tom</tt>:<br>
</big></p>
<p><big><tt><br>
enable_vdomain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yes<br>
vdomain_admlist&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; admin_tom<br>
vdomain_vmpop3_pwdpath&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /etc/virtual<br>
vdomain_vmpop3_pwdname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; passwd<br>
vdomain_vmpop3_mailpath&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/spool/virtual<br>
vdomain_postfix_aliases&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /etc/aliases<br>
vdomain_postfix_virtual&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /etc/postfix/virtual.cf<br>
vdomain_postfix_postalias&nbsp;&nbsp;&nbsp;&nbsp; /usr/sbin/postalias<br>
vdomain_postfix_postmap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /usr/sbin/postmap<br>
</tt></big><br>
</p>
<p>&nbsp;
</p>

<p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For our virtual user <tt>joe</tt> at <tt>widgets.com</tt> we'd create a
text file called <tt>widgets.com</tt> containing:</font><font size="+1"></font>
</p><p><tt><font size="+1">mailspooldir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/var/spool/virtual/widgets.com</font></tt>
<br><tt><font size="+1">auth_withdomain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
yes</font></tt>
<br><tt><font size="+1">auth_module&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_vdomain.pl</font></tt><br><big><tt>
domainnames&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; widgets.com<br>
</tt></big>
<tt><font size="+1">use_homedirspools&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>

<tt><font size="+1">use_syshomedir&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; no</font></tt>
<br>

<tt><font size="+1">enable_autoreply&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>

<tt><font size="+1">enable_setforward&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>
<br>
</p>
<p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
And for <tt>john</tt> at <tt>virtualcompany.com</tt>, create a text file
called <tt>virtualcompany.com</tt>&nbsp; containing:</font>
</p>
<p><tt><font size="+1">mailspooldir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/var/spool/virtual/virtualcompany.com</font></tt>
<br><tt><font size="+1">auth_withdomain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
yes</font></tt>
<br><tt><font size="+1">auth_module&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
auth_vdomain.pl</font></tt><br><big><tt>
domainnames&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;virtualcompany.com<br>
</tt></big><tt><font size="+1">use_homedirspools&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>

<tt><font size="+1">use_syshomedir&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; no</font></tt>
<br>

<tt><font size="+1">enable_autoreply&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>

<tt><font size="+1">enable_setforward&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; no</font></tt>
<br>
<br>

</p><p><font size="+1">&nbsp;</font>
<br><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
This will configure OWM so that when a virtual user logs in using their
full e-mail address (e.g. <tt>john@virtualcompany.com</tt> or<tt> joe@widgets.com</tt>),&nbsp;
OWM will use the configuration file for that domain (i.e. <tt>virtualcompany.com</tt>
or <tt>widgets.com</tt>).&nbsp; The config file for these sites will tell
OWM to authenticate the user using the virtual password files of vm-pop3d.&nbsp; Optionally, you would also include all the </font><font size="+1"><tt>vdomain</tt> config lines in each sites.conf file above if you wanted to use your browser to maintain the virtual users.</font> <br><font size="+1"></font>&nbsp;
</p><p><b><u><font size="+1">Step 5</font></u></b>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
We need to make a directory in <tt>/etc/virtual</tt> to hold the password
file for this domain.&nbsp; This is the directory that vm-pop3d looks in
when it authenticates a user.&nbsp; So we'd do this:</font>
</p><p><tt><font size="+1">mkdir /etc/virtual/domain</font></tt>
<br><tt><font size="+1"></font></tt>&nbsp;
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For our user <tt>joe</tt>, we'd execute:</font>
</p><p><tt><font size="+1">mkdir /etc/virtual/widgets.com</font></tt><tt><font size="+1"></font></tt>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For our user <tt>john</tt>, we'd execute:</font><font size="+1"></font>
</p><p><tt><font size="+1">mkdir /etc/virtual/virtualcompany.com</font></tt>
<br><tt><font size="+1"></font></tt>&nbsp;
<br>&nbsp;
</p><p><b><u><font size="+1">Step 6</font></u></b>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Now we need to create a password for this user.&nbsp; Using the addpasswd
script laid out on the vm-pop3d homepage, we'd execute this command:</font>
</p><p><tt><font size="+1">addpasswd username password &gt;&gt; /etc/virtual/domain/passwd</font></tt>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For our example, if user john wanted the password 'turtle', we'd execute:</font>
</p><p><tt><font size="+1">addpasswd john turtle &gt;&gt; /etc/virtual/virtualcompany.com/passwd</font></tt>
<br>&nbsp;
<br>&nbsp;
<br>
</p>
<p><b><u><font size="+1">Possible Step 7</font></u></b>
</p>
<p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
If you are using Sendmail or are keeping your virtual user table in the normal Sendmail location you might need to set the </font><font size="+1"><tt>virtusertable</tt>
&nbsp;configuration option. &nbsp;What happens is OWM will pull in the virtual
user table and transform the address before it tries authenticating the user using the vm-pop3d password files.
&nbsp;To resolve this add this option to </font><font size="+1"><tt>openwebmail.conf</tt>:<br>
</font></p>
<p><big><tt>virtusertable&nbsp; /etc/notable</tt></big><br>
</p>
<p><font size="+1"></font><br>

</p>
<p><b><u><font size="+1">Conclusion</font></u></b>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
And that's it!&nbsp; A real user with an e-mail account at the domain of
the machine can log into Open WebMail by just putting in their user name
in the login screen.&nbsp; A virtual user needs to put in their full e-mail
address (i.e. username@domain).</font><font size="+1"></font>
</p><p><font size="+1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
For pop3 mail retrieval, a real user would send just their user name to
the pop3 server, a virtual user would send their full e-mail address (in
either the form 'username:domain" or 'username@domain').</font>&nbsp;</p>
<p><br>
</p>
<p><br>
<b><u><big>Using&nbsp; auth_pop3.pl</big></u></b><br>
</p>
<p>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <big>There might
be situations where you want or need to use the <tt>auth_pop3.pl</tt> module to authenticate your virtual users. &nbsp;One situation would be where
the mail for this virtual domain is stored on a different computer from where
OWM is running. &nbsp;For this you'd need to use this module.
&nbsp;It's fairly straight forward to setup, just
make the appropriate changes to </big><font size="+1"><tt>$pop3_authserver, $pop3_authport</tt>,
and <tt>$local_uid</tt> for your system. &nbsp;Once these are setup just change </font><tt><font size="+1">
auth_module</font></tt> <big>in your sites.conf file to use this module.<font size="+1"><big><br>

</big></font></big></p>
<p><br>
Last modified: March 13th, 2003
</p>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
</body></html>